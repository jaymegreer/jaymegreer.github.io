<?php
session_start();

function calculatePenaltyScore($word1, $word2) {
    $word1 = strtolower($word1);
    $word2 = strtolower($word2);

    $exactMatchPenalty = 0;
    $consonantConsonantPenalty = 1;
    $vowelVowelPenalty = 1;
    $vowelConsonantPenalty = 3;
    $gapPenalty = 2;

    $matrix = array_fill(0, strlen($word1) + 1, array_fill(0, strlen($word2) + 1, 0));

    for ($i = 1; $i <= strlen($word1); $i++) {
        for ($j = 1; $j <= strlen($word2); $j++) {
            $match = ($word1[$i - 1] == $word2[$j - 1]) ? $matrix[$i - 1][$j - 1] + $exactMatchPenalty : $matrix[$i - 1][$j - 1] + $consonantConsonantPenalty;

            $delete = $matrix[$i - 1][$j] + $gapPenalty;

            $insert = $matrix[$i][$j - 1] + $gapPenalty;

            if (isVowel($word1[$i - 1]) && isVowel($word2[$j - 1])) {
                $replace = $match;
            } 
            elseif (!isVowel($word1[$i - 1]) && !isVowel($word2[$j - 1])) {
                $replace = $match;
            } 
            else {
                $replace = $match + $vowelConsonantPenalty;
            }
            $matrix[$i][$j] = min($delete, $insert, $replace);
        }
    }
    return $matrix[strlen($word1)][strlen($word2)];
}


function isVowel($char) {
    return in_array(strtolower($char), ['a', 'e', 'i', 'o', 'u']);
}


function getSuggestions($inputWord, $dictionary) {
    $scores = array();

    while (!feof($dictionary)) {
        $word = trim(fgets($dictionary));
        $word = strtolower($word);
        $score = calculatePenaltyScore($inputWord, $word);
        $scores[$word] = $score;
    }

    fclose($dictionary);

    asort($scores);

    return array_slice($scores, 0, 10);
}


if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $inputWord = strtolower($_POST['word']);

    $_SESSION['inputWord'] = $inputWord;

    $dictionary = fopen("dictionary.txt", "r") or die("Unable to open file!");

    $suggestions = getSuggestions($inputWord, $dictionary);
} 
else {
    $inputWord = isset($_SESSION['inputWord']) ? $_SESSION['inputWord'] : '';

    $dictionary = fopen("dictionary.txt", "r") or die("Unable to open file!");

    $suggestions = getSuggestions($inputWord, $dictionary);
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spell Checker</title>
</head>

<body>
    <h1><b>Spell Checker</b></h1>

    <form action="spell_checker.php" method="post" onsubmit="checkSpell(); return false;">
        <label for="word">Enter Word:</label><br>
        <input type="text" id="word" name="word" value="<?php echo htmlspecialchars($inputWord); ?>" required><br><br>
        <input type="submit" value="Check">
    </form>

    <h2>Suggestions:</h2>
    <div id="suggestion-box">
        <?php
        foreach ($suggestions as $word => $score) {
            echo $word . ' (Score: ' . $score . ')<br>';
        }
        ?>
    </div>

    <script>
        function checkSpell() {
            var wordInput = document.getElementById('word').value;
            var suggestionBox = document.getElementById('suggestion-box');

            fetch('spell_checker.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'word=' + encodeURIComponent(wordInput),
            })
            .then(response => response.text())
            .then(data => {
                suggestionBox.innerHTML = data;
            })
            .catch(error => console.error('Error:', error));
        }
    </script>

</body>
</html>
